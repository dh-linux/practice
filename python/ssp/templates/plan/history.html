<!DOCTYPE html>
{%extends 'base.html'%}
{%block content_row%}
<div class="container">
  <div class="row">
     <div class="col-xs-12">
        <div class="table-responsive">
          <div role="grid" class="dataTables_wrapper" id="sample-table-2_wrapper">

            <div class="row">
              <div class="col-sm-5">
                <form class="input-group" method="post" action="/plan/task/">
                  <input type="text" name="search" id="search" placeholder="PID/申请人/执行时间" class="form-control search-query">
                    <span class="input-group-btn">
                      <button class="btn btn-purple btn-sm" type="submit">
                        Search
                        <i class="icon-search icon-on-right bigger-110"></i>
                      </button>
                    </span>
                </form>
                <div class="hide"><a id="search_data" title="{{search_data}}"></a></div>
              </div>
            </div>                  

            <table class="table table-striped table-bordered table-hover dataTable" id="sample-table-2" aria-describedby="sample-table-2_info">
              <thead>
                <tr role="row">
                  <th class="sorting_disabled">Plan_ID</th>
                  <th class="sorting_disabled">申请人</th>
                  <th class="sorting" role="columnheader" tabindex="0" aria-controls="sample-table-2" rowspan="1" colspan="1" aria-label="Update: activate to sort column ascending">执行时间</th>
                  <th class="sorting_disabled">状态</th>
                  <th class="sorting_disabled">操作</th>
                </tr>
              </thead>
             
              <tbody id="pagetask" role="alert" aria-live="polite" aria-relevant="all">
                {% for task in page_task %}
                <tr class="odd">
                    <td class="left"><a href="http://10.212.0.62:8080/task/info?id={{task.PID}}">{{task.PID}}</a></td>
                    <td class="left">{{task.user}}</td>
                    <td class="left">{{task.date}}</td>
                    <td class="left">{{task.get_status_display}}</td>
                    <td class="left">详情</td>                                     
                </tr>
                {% endfor %}
              </tbody>
            </table>
            <div class="row">
              <div class="col-sm-6">
                <div class="dataTables_info" id="sample-table-2_info">Showing 1 to 10 of {{task_count}} entries</div>
              </div>
              <div class="col-sm-6">
                <div class="dataTables_paginate paging_bootstrap">
                  <ul class="pagination">
                    <li class="prev disabled">
                      <a href="#"><i class="icon-double-angle-left"></i></a>
                    </li>
                    {% for i in page_list %}
                        <li><a href="#" class="test" title="{{i}}">{{i}}</a></li>
                    {% endfor %}
                    <li class="next">
                      <a href="#"><i class="icon-double-angle-right"></i></a>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>
        </div>
  </div><!--/row-->
</div><!--/contariner-->
{%endblock%}
{% block js %}
<script type="text/javascript">
function makeTable(data){
    $("table tbody").text("");
    for (var i=0;i<data.length;i++){
        tr = '<tr class="odd">'
              + '<td class="left"><a href="http://10.212.0.62:8080/task/info?id=' + data[i].PID + '">' + data[i].PID + '</a></td>'
              + '<td class="left">' + data[i].user + '</td>'
              + '<td class="left">' + data[i].date + '</td>'
              + '<td class="left">' + data[i].status + '</td>'
              + '<td class="left">详情</td>'                                     
              +  '</tr>'
        var tbody_html = tbody_html + tr;
    };
    $("table tbody").html(tbody_html);
};
$("a.test").click(function(){
    var page = $(this).attr("title");
    var search_data = $("#search_data").attr("title");
    if(search_data == ""){
        var sendDate = {'page':page};
    }else{
        var sendDate = {'page':page, 'search_data':search_data};
    };
    var url = "/plan/task/api/";
    $.ajax({
      url:url,
      dataType:"json",
      type:'post',
      data:sendDate,
      success:function(data){
        makeTable(data);
      }
    });
    $("li").each(function(){
        $(this).removeClass("active");
    });
    $(this).parent().addClass("active");
});
</script>
{% endblock %}
